---
layout: post
title:  "Apktool: Repack Android Apk"
author: "Bomjh"
categories: "Reversing"
---

[Apktool](https://ibotpeaches.github.io/Apktool/)은 APK를 거의 원본 형식으로 디코딩하고, 수정 작업 후에 다시 빌드할 수 있도록 도와주는 도구입니다. Java만 설치되어 있으면 `apktool.bat` 파일을 사용하여 쉽게 리패킹을 할 수 있습니다.

## Decoding

{% highlight bash %}
$ apktool d test.apk
I: Using Apktool 2.4.0 on test.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
I: Loading resource table from file: 1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values */* XMLs...
I: Baksmaling classes.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
{% endhighlight %}

디코드 결과로 resource, smali, AndroidManifest 등의 파일들을 얻을 수 있습니다. 원하는 파일을 추출 및 수정할 수 있습니다.

![apktool1](https://raw.githubusercontent.com/bomjh/bomjh.github.io/master/assets/apktool1.png)
_decode_

## Building

{% highlight bash %}
$ apktool b test
I: Using Apktool 2.4.0 on test
I: Checking whether sources has changed...
I: Smaling smali folder into classes.dex...
I: Checking whether resources has changed...
I: Building resources...
I: Building apk file...
I: Copying unknown files/dir...
{% endhighlight %}

빌드 결과로 수정된 APK 파일이 생성됩니다. 빌드된 APK 파일은 서명 도구를 사용하여 재서명을 해야합니다. 빌드 시 resource 관련 에러가 발생하면 아래 명령어로 framework를 삭제해주고 다시 빌드하면 에러 없이 컴파일이 됩니다.

{% highlight bash %}
$ apktool empty-framework-dir --force
{% endhighlight %}